---
interface Testimonial {
  name: string;
  business: string;
  quote: string;
  photoUrl: string;
}

interface Props {
  testimonials?: Testimonial[];
}

const testimonials: Testimonial[] = [
  {
    name: "Dr. Jay Cho",
    business: "Active Care",
    quote:
      "Matt made a new website for my business. It was the best choice I've made so far, because it looks great. Very reasonable and very professional. And he made it all in time even with an urgent request.",
    photoUrl: "/images/cho-headshot.png",
  },
  {
    name: "Chris Gordon",
    business: "CGN",
    quote:
      "Excellent work! I have a terrific new website that is everything I wanted. I was guided through the whole process in a collaborative process. Matt Birch was patient and professional. My highest recommendation!",
    photoUrl: "/images/cg-headshot.jpg",
  },
  {
    name: "Bridget Costello",
    business: "Lynch's Landing",
    quote:
      "I can't say enough about how swift and professional our experience with this company has been. Matt created a beautiful new website for our business. We are very happy with his work.",
    photoUrl: "/images/bc-headshot.jpg",
  },
  {
    name: "Ann Gorman",
    business: "Blacktop Ohio",
    quote:
      "Matt was great to work with, I love the website he built for me, I have already recommended him to a few of my family members who are also business owners.",
    photoUrl: "/images/ag-headshot.jpg",
  },
];
---

<div
  class="swiper-container relative testimonial-container rounded-full transition-all duration-300"
>
  <div class="swiper-wrapper">
    {
      testimonials && testimonials.length > 0 ? (
        testimonials.map((testimonial) => (
          <div class="swiper-slide">
            <div class="testimonial-card rounded-full p-6 shadow-lg text-white relative overflow-hidden max-w-xs md:max-w-md lg:max-w-lg mx-auto">
              <div class="testimonial-photo-wrapper">
                <img
                  src={testimonial.photoUrl}
                  alt={`Headshot of ${testimonial.name}`}
                  class="testimonial-photo w-24 h-24 rounded-full object-cover mx-auto shadow-lg mb-4"
                  loading="lazy"
                />
              </div>
              <div class="text-center">
                <p class="text-2xl font-semibold">{testimonial.name}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  {testimonial.business}
                </p>
                <p class="text-gray-600 dark:text-gray-200 italic mt-4">
                  "{testimonial.quote}"
                </p>
              </div>
            </div>
          </div>
        ))
      ) : (
        <p>No testimonials available.</p>
      )
    }
  </div>

  <div class="swiper-button-prev"></div>
  <div class="swiper-button-next"></div>
  <div class="swiper-pagination"></div>
</div>

<script>
  import Swiper from "swiper";
  import { Navigation, Pagination, Autoplay } from "swiper/modules";
  import "swiper/css";
  import "swiper/css/navigation";
  import "swiper/css/pagination";

  function initSwiper() {
    if (document.querySelector(".swiper-initialized")) return;

    new Swiper(".swiper-container", {
      modules: [Navigation, Pagination, Autoplay],
      loop: true,
      slidesPerView: 1,
      spaceBetween: 30,
      autoplay: {
        delay: 5000,
        disableOnInteraction: false,
      },
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      // Disable dragging for the cards while keeping Swiper interaction
      allowSlideNext: true,
      allowSlidePrev: true,
      noSwiping: true, // Disable swiping on specific elements
      noSwipingClass: "testimonial-card", // Prevent swiping on testimonial-card
    });
  }

  // Initialize Swiper on page load
  document.addEventListener("DOMContentLoaded", initSwiper);

  // Re-initialize Swiper when the page content is updated (for Astro view transitions)
  document.addEventListener("astro:page-load", initSwiper);
</script>

<style>
  .swiper-container {
    width: 100%;
    height: auto;
    padding: 2rem;
    overflow: hidden;
  }

  /* Rest of the styles remain the same */

  .swiper-button-prev,
  .swiper-button-next {
    color: var(--swiper-navigation-color, var(--testimonial-text));
  }

  .swiper-button-prev {
    left: 2rem;
  }

  .swiper-button-next {
    right: 2rem;
  }

  .swiper-button-prev,
  .swiper-button-next {
    color: var(--swiper-navigation-color, var(--testimonial-text));
  }

  .swiper-pagination-bullet {
    background: var(--swiper-pagination-color, var(--testimonial-text));
  }

  .testimonial-card {
    background: var(--testimonial-bg-light);
    color: var(--testimonial-text-light);
    border: 1px solid rgba(255, 255, 255, 0.1);
    /* Subtle, light border */
    box-shadow:
      0 8px 16px rgba(0, 0, 0, 0.1),
      0 4px 8px rgba(66, 153, 225, 0.2);
    /* Light blue shadow */
    transition: box-shadow 0.3s ease;
  }

  .testimonial-card:hover {
    box-shadow:
      0 12px 24px rgba(0, 0, 0, 0.2),
      0 6px 12px rgba(66, 153, 225, 0.3);
    /* More prominent blue glow */
  }

  .testimonial-card p {
    margin-bottom: 1rem;
    /* Add space below the name and business fields */
    line-height: 1.5;
    /* Improve readability */
  }

  .testimonial-card p:last-of-type {
    margin-bottom: 2rem;
    /* Add more space for the description on the bottom */
  }

  .dark .testimonial-card {
    background: var(--testimonial-bg-dark);
    color: var(--testimonial-text-dark);
    border: 1px solid rgba(255, 255, 255, 0.1);
    /* Subtle border for Dark Mode */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    /* Slight shadow for more depth */
  }

  .dark .testimonial-card:hover {
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
  }

  .testimonial-container {
    background: var(--testimonial-bg-light);
    border: 0.5px solid rgba(0, 0, 0, 0.05);
    /* Subtle, less pronounced border */
    box-shadow:
      0 0 0 1px rgba(0, 0, 0, 0.02),
      0 4px 6px -1px rgba(0, 0, 0, 0.05),
      0 2px 4px -1px rgba(0, 0, 0, 0.03);
    /* Subtle shadow in regular state */
    transition:
      box-shadow 0.3s ease,
      border-color 0.3s ease;
  }

  .dark .testimonial-container {
    background: linear-gradient(to bottom right, #1f2937, #111827);
    border: 0.5px solid rgba(255, 255, 255, 0.05);
    /* Subtle, less pronounced border */
    box-shadow:
      0 0 0 1px rgba(255, 255, 255, 0.02),
      0 4px 6px -1px rgba(0, 0, 0, 0.15),
      0 2px 4px -1px rgba(0, 0, 0, 0.1);
    /* Subtle shadow in regular state */
  }

  .testimonial-container:hover {
    box-shadow:
      0 0 0 1px rgba(0, 0, 0, 0.05),
      0 12px 20px -3px rgba(0, 0, 0, 0.15),
      /* More pronounced shadow on hover */ 0 6px 10px -2px rgba(0, 0, 0, 0.1);
  }

  .dark .testimonial-container:hover {
    box-shadow:
      0 0 0 1px rgba(255, 255, 255, 0.1),
      0 12px 20px -3px rgba(0, 0, 0, 0.4),
      /* More pronounced shadow on hover */ 0 6px 10px -2px rgba(0, 0, 0, 0.3);
  }

  /*Media quieries for padding */

  @media (min-width: 640px) {
    /* sm: small devices like tablets */
    .testimonial-card {
      padding: 3rem;
      /* Increase padding on small devices */
      max-width: 80%;
      /* Adjust max-width for small devices */
    }
  }

  @media (min-width: 768px) {
    /* md: medium devices like small laptops */
    .testimonial-card {
      padding: 4rem;
      /* Further increase padding on medium devices */
      max-width: 70%;
      /* Adjust max-width for medium devices */
    }
  }

  @media (min-width: 1024px) {
    /* lg: large devices like desktops */
    .testimonial-card {
      padding: 2rem;
      /* Larger padding on large devices */
      max-width: 50%;
      /* Adjust max-width for large devices */
    }
  }
</style>

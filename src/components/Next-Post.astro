---
// src/components/Next-Post.astro
import type { CollectionEntry } from "astro:content";

type PostEntry = CollectionEntry<"posts">;

interface Props {
  next?: PostEntry | null;
}

const { next } = Astro.props;

// optional excerpt type guard
function hasExcerpt(d: unknown): d is { excerpt: string } {
  return !!d && typeof (d as Record<string, unknown>).excerpt === "string";
}

const title = next?.data.title ?? "More from the blog";

/** Links */
const hrefTitle = next ? `/blog/${next.slug}` : "/blog/";
const hrefCta = next ? `/blog/${next.slug}` : "/blog/";

/** Body text */
const excerpt = next
  ? hasExcerpt(next.data) && next.data.excerpt?.trim()
    ? next.data.excerpt
    : (next.data.description ?? "")
  : "";
---

<section class="next-fullbleed">
  <div class="next-band">
    <div class="mx-auto max-w-prose px-4 sm:px-6">
      <div class="next-card">
        <p class="next-kicker">Up next</p>

        <!-- Title → next or /blog -->
        <a href={hrefTitle} rel={next ? "next" : undefined} class="group block">
          <h3 class="next-title group-hover:underline">
            {title}
          </h3>
        </a>

        {excerpt && <p class="next-excerpt line-clamp-2">{excerpt}</p>}

        <!-- CTA → next or /blog -->
        <a
          href={hrefCta}
          rel={next ? "next" : undefined}
          aria-label={next
            ? `Read next: ${next.data.title}`
            : "Browse the blog"}
          class="next-cta"
        >
          Read next
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  /* ----------------------------------------------------
     Full-bleed band w/ the same vibe as Share
     ---------------------------------------------------- */
  :root {
    --next-vignette-w: 1400px;
    --next-vignette-h: 180px;
    --next-vignette-alpha: 0.68;
  }

  .next-fullbleed {
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    width: 100vw;
  }

  /* Band backgrounds */

  /* LIGHT only */
  .next-band {
    position: relative;
    isolation: isolate;
    border-block: 1px solid rgba(226, 232, 240, 0.6); /* slate-200/60 */
    background:
      radial-gradient(
        var(--next-vignette-w) var(--next-vignette-h) at 50% 46%,
        rgba(226, 232, 240, var(--next-vignette-alpha)),
        rgba(226, 232, 240, 0) 72%
      ),
      linear-gradient(
        to bottom,
        rgba(250, 250, 250, 0.98) 0%,
        rgba(241, 245, 249, 1) 48%,
        rgba(250, 250, 250, 0.98) 100%
      );
    -webkit-mask-image: linear-gradient(
      to bottom,
      transparent 0,
      black 0%,
      black 100%
    );
    mask-image: linear-gradient(to bottom, transparent 0, black 0%, black 100%);

    /* section rhythm */
    padding-top: 3rem;
    padding-bottom: 3rem;
  }

  /* DARK: remove band effects → transparent container */
  :global(.dark) .next-band {
    background: none !important;
    border-block: none !important;
    -webkit-mask-image: none !important;
    mask-image: none !important;
  }

  @media (min-width: 768px) {
    .next-band {
      padding-top: 5rem;
      padding-bottom: 5rem;
    }
  }

  /* ----------------------------------------------------
     Card styling (lighter, integrated)
     ---------------------------------------------------- */
  .next-card {
    border-radius: 1rem; /* 16px */
    background: rgba(255, 255, 255, 0.72);
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(15, 23, 42, 0.08);
    padding: 1.25rem 1.25rem; /* px-5 py-5 */
  }
  @media (min-width: 640px) {
    .next-card {
      padding: 2rem 2rem;
    } /* sm:px-8 sm:py-8 vibe */
  }
  :global(.dark) .next-card {
    background: rgba(2, 6, 23, 0.55);
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
  }

  .next-kicker {
    font-size: 0.8125rem; /* text-sm */
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #475569; /* slate-600 */
    margin-bottom: 0.5rem;
  }
  :global(.dark) .next-kicker {
    color: #cbd5e1;
  } /* slate-300 */

  .next-title {
    font-size: clamp(1.5rem, 2.6vw, 2rem);
    line-height: 1.2;
    font-weight: 800;
    color: #0f172a; /* slate-900 */
  }
  :global(.dark) .next-title {
    color: #f1f5f9;
  } /* slate-100 */

  .next-excerpt {
    margin-top: 0.5rem;
    color: #334155; /* slate-700 */
  }
  :global(.dark) .next-excerpt {
    color: #cbd5e1;
  } /* slate-300 */

  .next-cta {
    margin-top: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: #1d4ed8; /* blue-700 */
    text-decoration: none;
  }
  .next-cta:hover {
    text-decoration: underline;
  }
  :global(.dark) .next-cta {
    color: #7dd3fc;
  } /* sky-300 */

  /* Basic line-clamp without plugin */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
